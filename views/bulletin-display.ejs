<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8"> border-bottom: 1px solid #ccc;
    }

    .welcome-section {
    text-align: center;
    font-style: italic;
    margin: 1.5rem 0;
    padding: 1rem;
    border: 1px solid #ddd;
    background: #f9f9f9;
    font-size: 1.1rem;
    font-weight: 500;
    }
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Navigation Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1000;
            padding: 15px 0;
            border-bottom: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .navigation-container {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .nav-section {
            position: relative;
        }

        .nav-accordion-btn {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            min-width: 120px;
            justify-content: center;
        }

        .nav-accordion-btn:hover {
            background: #5a32a3;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-accordion-btn.active {
            background: #007bff;
            font-weight: 600;
        }

        .nav-accordion-content {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            min-width: 220px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 6px;
            border: 1px solid #dee2e6;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            margin-top: 5px;
        }

        .nav-accordion-content.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-accordion-item {
            display: block;
            padding: 12px 16px;
            color: #495057;
            text-decoration: none;
            border-bottom: 1px solid #f1f3f4;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .nav-accordion-item:hover {
            background: #f8f9fa;
            color: #6f42c1;
            text-decoration: none;
            padding-left: 20px;
        }

        .nav-accordion-item:last-child {
            border-bottom: none;
        }

        .nav-options-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            min-width: 120px;
            justify-content: space-between;
        }

        .nav-options-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .accordion-icon {
            transition: transform 0.3s ease;
        }

        .accordion-icon.rotated {
            transform: rotate(180deg);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #6f42c1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(111, 66, 193, 0.3);
        }

        .user-status-indicator {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background: #28a745;
            border: 2px solid white;
            border-radius: 50%;
        }

        .user-dropdown {
            position: relative;
        }

        .user-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            min-width: 280px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            z-index: 1001;
            border: 1px solid #dee2e6;
            margin-top: 10px;
        }

        .user-dropdown-content.show {
            display: block;
        }

        .user-dropdown-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            background: white;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar-large {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #6f42c1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            flex-shrink: 0;
        }

        .user-dropdown-item {
            padding: 14px 20px;
            color: #495057;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            font-size: 15px;
            border: none;
            background: white;
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        .user-dropdown-item:hover {
            background: #f8f9fa;
        }

        .user-dropdown-item:last-child {
            border-radius: 0 0 8px 8px;
        }

        .user-dropdown-item.logout {
            color: #dc3545;
            border-top: 1px solid #e9ecef;
        }

        .user-dropdown-item.logout:hover {
            background: #fff5f5;
        }

        .dropdown-icon {
            font-size: 18px;
            width: 20px;
            display: inline-block;
            text-align: center;
        }

        .dropdown-divider {
            height: 1px;
            background: #e9ecef;
            margin: 0;
        }

        .user-role {
            color: #6c757d;
            font-size: 0.875rem;
            display: block;
        }

        .user-status {
            color: #28a745;
            font-size: 0.875rem;
            display: block;
        }

        .nav-header {
            background: linear-gradient(135deg, #6f42c1 0%, #007bff 100%);
            color: white;
            padding: 0.75rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .nav-brand {
            font-size: 1.25rem;
            font-weight: 600;
            text-decoration: none;
            color: white;
        }

        .nav-brand:hover {
            color: rgba(255, 255, 255, 0.9);
        }

        .nav-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-nav {
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            font-size: 0.875rem;
            padding: 0.375rem 0.75rem;
        }

        .btn-nav:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
        }

        @media print {
            .nav-header {
                display: none !important;
            }
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Times New Roman', serif;
            line-height: 1.4;
        }

        .bulletin-container {
            max-width: 600px;
            margin: 2rem auto;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #dee2e6;
            font-family: 'Times New Roman', Times, serif;
        }

        .bulletin-header {
            text-align: center;
            padding: 2rem 2rem 1rem;
            border-bottom: 2px solid #000;
        }

        .church-logo {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            border: 2px solid #333;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 0.8rem;
            color: #666;
        }

        .ward-name {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ward-location {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 1.5rem;
            font-style: italic;
        }

        .selected-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            margin-bottom: 1rem;
        }

        .quote-section {
            font-style: italic;
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
        }

        .quote-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .quote-reference {
            font-size: 0.9rem;
            color: #666;
            font-weight: bold;
        }

        .bulletin-content {
            padding: 2rem;
            line-height: 1.8;
            color: #000;
        }

        .meeting-info {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #333;
        }

        .meeting-date {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meeting-type {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .meeting-time {
            font-size: 1.1rem;
            color: #666;
        }

        .roles-section {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
        }

        .role-line {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .role-title {
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .dots {
            flex: 1;
            border-bottom: 1px dotted #000;
            margin: 0 0.5rem;
            height: 0px;
            align-self: baseline;
            position: relative;
            top: -3px;
        }

        .role-name {
            font-weight: normal;
        }

        .program-section {
            margin-bottom: 2rem;
        }

        .program-item {
            margin-bottom: 1.2rem;
        }

        .program-line {
            display: flex;
            align-items: baseline;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .program-title {
            font-weight: bold;
            margin-right: 0.5rem;
            min-width: fit-content;
            font-size: 1rem;
        }

        .scripture-reference {
            font-size: 0.8rem;
            font-weight: normal;
            margin-right: 0.3rem;
        }

        .scripture-title {
            font-size: 0.8rem;
            font-style: italic;
        }

        .program-detail {
            margin-left: 2rem;
            font-style: italic;
            color: #444;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .centered-item {
            text-align: center;
            font-style: italic;
            margin: 1.5rem 0;
            font-size: 1.1rem;
            font-weight: 500;
            padding: 0.5rem;
            border-top: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
            font-size: 1.1rem;
        }

        .welcome-section {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #e9ecef;
            border-radius: 5px;
        }

        .ward-business {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .ward-business-header {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .edit-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .editable-field {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .editable-field:hover {
            background-color: #fff3cd;
        }

        .floating-nav {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .fab-primary {
            background: linear-gradient(135deg, #6f42c1 0%, #007bff 100%);
            color: white;
        }

        .fab-secondary {
            background: #6c757d;
            color: white;
        }

        @media print {
            body {
                background: white;
            }

            .edit-controls {
                display: none;
            }

            .bulletin-container {
                box-shadow: none;
                border: none;
                margin: 0;
                max-width: none;
            }
        }

        /* Responsive contact grid */
        .contact-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            padding: 0 20px;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Contact table layout */
        .contact-table {
            width: 100%;
            border-collapse: collapse;
        }

        .contact-header {
            display: grid;
            grid-template-columns: 1.8fr 1.8fr 2fr;
            gap: 15px;
            background-color: #6f42c1;
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
        }

        .contact-row {
            display: grid;
            grid-template-columns: 1.8fr 1.8fr 2fr;
            gap: 15px;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .contact-row:nth-child(even) {
            background-color: #f8f9fa;
        }

        .contact-row:hover {
            background-color: #e9ecef;
        }

        .contact-col-title {
            font-weight: 600;
            color: #333;
        }

        .contact-col-name {
            color: #555;
        }

        .contact-col-phone {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        /* Interactive Hymn Links */
        .hymn-link {
            color: #6f42c1;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .hymn-link:hover {
            color: #5a32a3;
            text-decoration: underline;
        }

        .hymn-link i {
            font-size: 0.9em;
            margin-left: 3px;
        }

        /* Person Info Bubble */
        .person-with-info {
            cursor: pointer;
            color: #007bff;
            position: relative;
            transition: all 0.2s ease;
        }

        .person-with-info:hover {
            color: #0056b3;
            text-decoration: underline;
        }

        .person-info-icon {
            font-size: 0.85em;
            margin-left: 4px;
            opacity: 0.7;
        }

        /* Person Info Modal */
        .person-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .person-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: none;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .person-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #6f42c1;
        }

        .person-modal-header h3 {
            margin: 0;
            color: #6f42c1;
            font-size: 1.5rem;
        }

        .person-modal-close {
            color: #aaa;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .person-modal-close:hover,
        .person-modal-close:focus {
            color: #000;
            transform: scale(1.1);
        }

        .person-modal-body {
            color: #333;
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        @media (max-width: 768px) {
            .contact-content {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 0 10px;
            }

            .contact-header,
            .contact-row {
                grid-template-columns: 1fr;
                gap: 5px;
                text-align: left;
            }

            .contact-header {
                padding: 10px;
            }

            .contact-row {
                padding: 8px 10px;
                border-left: 3px solid #6f42c1;
                margin-bottom: 5px;
            }

            .contact-col-title::after {
                content: ":";
            }
        }

        @media (max-width: 480px) {
            .contact-content {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 0 5px;
                font-size: 13px;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation Header -->
    <div class="container">
        <div class="header">
            <h1 style="margin: 0; font-size: 1.5rem;">üìå Bulletin</h1>

            <div class="d-flex align-items-center justify-content-between flex-grow-1">
                <!-- Navigation Container -->
                <div class="navigation-container">
                    <!-- Story Button -->
                    <div class="nav-section">
                        <a href="/story/dashboard" class="nav-accordion-btn" style="text-decoration: none;">
                            üìñ Story
                        </a>
                    </div>

                    <!-- Medicine Button -->
                    <div class="nav-section">
                        <a href="/medicine/dashboard" class="nav-accordion-btn" style="text-decoration: none;">
                            üíä Medicine
                        </a>
                    </div>

                    <!-- Bulletin Button -->
                    <div class="nav-section">
                        <a href="/bulletin" class="nav-accordion-btn active" style="text-decoration: none;">
                            üìå Bulletin
                        </a>
                    </div>

                    <!-- Bulletin Options Dropdown -->
                    <% if (user && ((user.permissions && user.permissions.accessBulletinManagement) ||
                        user.role==='admin' || user.role==='manager' )) { %>
                        <div class="nav-section">
                            <button class="nav-options-btn" onclick="toggleAccordion('bulletinOptionsAccordion')">
                                ‚öôÔ∏è Bulletin <span class="accordion-icon">‚ñº</span>
                            </button>
                            <div id="bulletinOptionsAccordion" class="nav-accordion-content">
                                <a href="/bulletin/admin" class="nav-accordion-item">
                                    <i class="fas fa-cog me-2"></i>Admin
                                </a>
                                <a href="/bulletin/<%= bulletin._id %>/edit" class="nav-accordion-item">
                                    <i class="fas fa-edit me-2"></i>Edit Bulletin
                                </a>
                                <button class="nav-accordion-item" onclick="window.print()"
                                    style="border: none; background: none; width: 100%; text-align: left;">
                                    <i class="fas fa-print me-2"></i>Print Bulletin
                                </button>
                            </div>
                        </div>
                        <% } else { %>
                            <div class="nav-section">
                                <button class="nav-accordion-btn" onclick="window.print()">
                                    <i class="fas fa-print me-1"></i>Print
                                </button>
                            </div>
                            <% } %>
                </div>

                <!-- User Info with Dropdown -->
                <% if (typeof user !=='undefined' && user) { %>
                    <div class="user-profile-section">
                        <div class="user-dropdown">
                            <div class="user-avatar" onclick="toggleUserDropdown()">
                                <%= user.firstName ? user.firstName.charAt(0).toUpperCase() : 'U' %>
                                <%= user.lastName ? user.lastName.charAt(0).toUpperCase() : '' %>
                            </div>
                            <div id="userDropdown" class="user-dropdown-content">
                                <div class="user-dropdown-header">
                                    <div class="user-avatar-large">
                                        <%= user.firstName ? user.firstName.charAt(0).toUpperCase() : '' %>
                                        <%= user.lastName ? user.lastName.charAt(0).toUpperCase() : '' %>
                                    </div>
                                    <div class="user-info">
                                        <strong><%= user.firstName %> <%= user.lastName %></strong>
                                        <small class="user-role"><%= user.role %></small>
                                        <small class="user-status">‚óè Online</small>
                                    </div>
                                </div>
                                
                                <!-- Admin Tools (only for admins and managers) -->
                                <% if (user.role === 'admin' || user.role === 'manager') { %>
                                <div class="user-dropdown-header" style="padding: 8px 15px; font-size: 12px; color: #6c757d;">
                                    Admin Tools
                                </div>
                                <a href="/auth/admin/users" class="user-dropdown-item">
                                    <span class="dropdown-icon">üë•</span> User Management
                                </a>
                                <a href="/auth/admin/audit-logs" class="user-dropdown-item">
                                    <span class="dropdown-icon">üîÑ</span> Audit Logs
                                </a>
                                <a href="/auth/admin/test-email" class="user-dropdown-item">
                                    <span class="dropdown-icon">‚úâÔ∏è</span> Test Email
                                </a>
                                <div class="dropdown-divider"></div>
                                <% } %>
                                
                                <!-- Other Modules -->
                                <div class="user-dropdown-header" style="padding: 8px 15px; font-size: 12px; color: #6c757d;">
                                    Other Modules
                                </div>
                                <a href="/purchase-orders" class="user-dropdown-item">
                                    <span class="dropdown-icon">üì¶</span> Purchase Orders
                                </a>
                                <a href="/story/dashboard" class="user-dropdown-item">
                                    <span class="dropdown-icon">üìñ</span> Story
                                </a>
                                <a href="/medicine/dashboard" class="user-dropdown-item">
                                    <span class="dropdown-icon">üíä</span> Medicine
                                </a>
                                <a href="/musicbox" class="user-dropdown-item">
                                    <span class="dropdown-icon">üéµ</span> MusicBox
                                </a>
                                <a href="/grocery/dashboard" class="user-dropdown-item">
                                    <span class="dropdown-icon">üõí</span> Grocery
                                </a>
                                <a href="/greatestjoy/dashboard" class="user-dropdown-item">
                                    <span class="dropdown-icon">‚ù§Ô∏è</span> Greatest Joy
                                </a>
                                
                                <div class="dropdown-divider"></div>
                                <form action="/auth/logout" method="POST" style="margin: 0;">
                                    <button type="submit" class="user-dropdown-item logout" style="border: none; background: none; width: 100%; text-align: left;">
                                        <span class="dropdown-icon">üö™</span> Logout
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                    <div class="user-info">
                        <a href="/auth/login" class="btn btn-primary btn-sm">Login</a>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Edit Controls (only visible to authorized users) -->
    <% if (false) { %>
        <div class="edit-controls">
            <div class="btn-group">
                <a href="/bulletin/admin" class="btn btn-primary btn-sm">
                    <i class="fas fa-cog"></i> Admin
                </a>
                <a href="/bulletin/<%= bulletin._id %>/edit" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-edit"></i> Edit
                </a>
                <button onclick="window.print()" class="btn btn-outline-secondary btn-sm">
                    <i class="fas fa-print"></i> Print
                </button>
            </div>
        </div>
        <% } %>

            <div class="bulletin-container">
                <!-- Header Section -->
                <div class="bulletin-header">
                    <!-- Church Logo -->
                    <div class="text-center">
                        <img src="/images/church-logo.png" alt="Church Logo" class="church-logo"
                            onerror="this.style.display='none'">
                    </div>

                    <!-- Ward Information -->
                    <div class="ward-name" data-field="wardName">
                        <%= bulletin.wardName %>
                    </div>
                    <div class="ward-location" data-field="wardLocation">
                        <%= bulletin.wardLocation %>
                    </div>

                    <!-- Selected Image -->
                    <% if (bulletin.selectedImage && bulletin.selectedImage.url) { %>
                        <img src="<%= bulletin.selectedImage.url %>"
                            alt="<%= bulletin.selectedImage.caption || 'Selected Image' %>" class="selected-image">
                        <% } %>

                            <!-- Quote Section -->
                            <% if (bulletin.quote && bulletin.quote.text) { %>
                                <div class="quote-section">
                                    <div class="quote-text" data-field="quote.text">
                                        "<%= bulletin.quote.text %>"
                                    </div>
                                    <div class="quote-reference" data-field="quote.reference">
                                        <%= bulletin.quote.reference %>
                                    </div>
                                </div>
                                <% } %>
                </div>

                <!-- Content Section -->
                <div class="bulletin-content">
                    <!-- Meeting Information -->
                    <div class="meeting-info">
                        <div class="meeting-date">
                            <%= bulletin.formattedDate %>
                        </div>
                        <div class="meeting-type" data-field="meetingType">
                            <%= bulletin.meetingType %>
                        </div>
                        <div class="meeting-time" data-field="meetingTime">
                            <%= bulletin.meetingTime %>
                        </div>
                    </div>

                    <!-- Roles Section -->
                    <div class="roles-section">
                        <div class="role-line">
                            <span class="role-title">Presiding</span>
                            <span class="dots"></span>
                            <span class="role-name editable-field" data-field="presiding">
                                <%= bulletin.presiding %>
                            </span>
                        </div>
                        <div class="role-line">
                            <span class="role-title">Conducting</span>
                            <span class="dots"></span>
                            <span class="role-name editable-field" data-field="conducting">
                                <%= bulletin.conducting %>
                            </span>
                        </div>
                        <div class="role-line">
                            <span class="role-title">Organist</span>
                            <span class="dots"></span>
                            <span class="role-name editable-field" data-field="organist">
                                <%= bulletin.organist %>
                            </span>
                        </div>
                        <div class="role-line">
                            <span class="role-title">Chorister</span>
                            <span class="dots"></span>
                            <span class="role-name editable-field" data-field="chorister">
                                <%= bulletin.chorister %>
                            </span>
                        </div>
                    </div>

                    <!-- Welcome Section -->
                    <div class="welcome-section">
                        <strong>Welcome to our visitors!</strong><br>
                        We are delighted to have you worship with us today.
                    </div>

                    <div class="program-section">
                        <!-- Opening Hymn -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">Opening Hymn</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="openingHymn.number">
                                    <% if (bulletin.openingHymn.url) { %>
                                        <a href="<%= bulletin.openingHymn.url %>" target="_blank" class="hymn-link" title="Listen on ChurchofJesusChrist.org">
                                            <%= bulletin.openingHymn.number %> <i class="fas fa-music"></i>
                                        </a>
                                    <% } else { %>
                                        <%= bulletin.openingHymn.number %>
                                    <% } %>
                                </span>
                            </div>
                            <div class="program-detail editable-field" data-field="openingHymn.title">
                                <%= bulletin.openingHymn.title %>
                            </div>
                        </div>

                        <!-- Invocation -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">Invocation</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="invocation.name">
                                    <% const invocationName = typeof bulletin.invocation === 'object' ? bulletin.invocation.name : bulletin.invocation; %>
                                    <% const invocationNotes = typeof bulletin.invocation === 'object' ? bulletin.invocation.notes : ''; %>
                                    <% if (invocationNotes) { %>
                                        <span class="person-with-info" data-person-name="<%= invocationName %>" data-person-notes="<%= invocationNotes %>" onclick="showPersonInfo(this)">
                                            <%= invocationName %> <i class="fas fa-info-circle person-info-icon"></i>
                                        </span>
                                    <% } else { %>
                                        <%= invocationName %>
                                    <% } %>
                                </span>
                            </div>
                        </div>

                        <!-- Ward Business -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">Ward Business</span>
                            </div>
                            <% if (bulletin.wardBusiness && bulletin.wardBusiness.display && bulletin.wardBusiness.items
                                && bulletin.wardBusiness.items.length> 0) { %>
                                <div class="ward-business">
                                    <div class="ward-business-header">Business Items:</div>
                                    <% bulletin.wardBusiness.items.forEach(item=> { %>
                                        <div>‚Ä¢ <%= item %>
                                        </div>
                                        <% }); %>
                                </div>
                                <% } %>
                        </div>

                        <!-- Sacrament Hymn -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">Sacrament Hymn</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="sacramentHymn.number">
                                    <% if (bulletin.sacramentHymn.url) { %>
                                        <a href="<%= bulletin.sacramentHymn.url %>" target="_blank" class="hymn-link" title="Listen on ChurchofJesusChrist.org">
                                            <%= bulletin.sacramentHymn.number %> <i class="fas fa-music"></i>
                                        </a>
                                    <% } else { %>
                                        <%= bulletin.sacramentHymn.number %>
                                    <% } %>
                                </span>
                            </div>
                            <div class="program-detail editable-field" data-field="sacramentHymn.title">
                                <%= bulletin.sacramentHymn.title %>
                            </div>
                        </div>

                        <!-- Administration of the Sacrament -->
                        <div class="centered-item">
                            Administration of the Sacrament
                        </div>

                        <!-- Speakers -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">1st Speaker</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="speakers.first.name">
                                    <% if (bulletin.speakers.first.notes) { %>
                                        <span class="person-with-info" data-person-name="<%= bulletin.speakers.first.name %>" data-person-notes="<%= bulletin.speakers.first.notes %>" onclick="showPersonInfo(this)">
                                            <%= bulletin.speakers.first.name %> <i class="fas fa-info-circle person-info-icon"></i>
                                        </span>
                                    <% } else { %>
                                        <%= bulletin.speakers.first.name %>
                                    <% } %>
                                </span>
                            </div>
                            <% if (bulletin.speakers.first.topic) { %>
                                <div class="program-detail editable-field" data-field="speakers.first.topic">
                                    Topic: <%= bulletin.speakers.first.topic %>
                                </div>
                                <% } %>
                        </div>

                        <!-- Special Music -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">Special Music</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="specialMusic.performer">
                                    <% if (bulletin.specialMusic.notes) { %>
                                        <span class="person-with-info" data-person-name="<%= bulletin.specialMusic.performer %>" data-person-notes="<%= bulletin.specialMusic.notes %>" onclick="showPersonInfo(this)">
                                            <%= bulletin.specialMusic.performer %> <i class="fas fa-info-circle person-info-icon"></i>
                                        </span>
                                    <% } else { %>
                                        <%= bulletin.specialMusic.performer %>
                                    <% } %>
                                </span>
                            </div>
                            <% if (bulletin.specialMusic.selection) { %>
                                <div class="program-detail editable-field" data-field="specialMusic.selection">
                                    <%= bulletin.specialMusic.selection %>
                                </div>
                                <% } %>
                        </div>

                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">2nd Speaker</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="speakers.second.name">
                                    <%= bulletin.speakers.second.name %>
                                </span>
                            </div>
                            <% if (bulletin.speakers.second.topic) { %>
                                <div class="program-detail editable-field" data-field="speakers.second.topic">
                                    Topic: <%= bulletin.speakers.second.topic %>
                                </div>
                                <% } %>
                        </div>

                        <!-- Closing Hymn -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">Closing Hymn</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="closingHymn.number">
                                    <%= bulletin.closingHymn.number %>
                                </span>
                            </div>
                            <div class="program-detail editable-field" data-field="closingHymn.title">
                                <%= bulletin.closingHymn.title %>
                            </div>
                        </div>

                        <!-- Benediction -->
                        <div class="program-item">
                            <div class="program-line">
                                <span class="program-title">Benediction</span>
                                <span class="dots"></span>
                                <span class="editable-field" data-field="benediction">
                                    <%= bulletin.benediction %>
                                </span>
                            </div>
                        </div>

                        <!-- Come, Follow Me Section -->
                        <div class="program-section mt-4">
                            <h4 class="section-header text-center mb-3"
                                style="border-bottom: 1px solid #333; padding-bottom: 8px;">Come, Follow Me</h4>

                            <div class="program-item">
                                <div class="program-line">
                                    <span class="program-title">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.currentWeek &&
                                            bulletin.comeFollowMe.currentWeek.date) ?
                                            bulletin.comeFollowMe.currentWeek.date : 'September 14' %>
                                    </span>
                                    <span class="dots"></span>
                                    <span class="scripture-reference">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.currentWeek &&
                                            bulletin.comeFollowMe.currentWeek.scripture) ?
                                            bulletin.comeFollowMe.currentWeek.scripture : 'D&C 98-101' %>
                                    </span>
                                    <span class="scripture-title">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.currentWeek &&
                                            bulletin.comeFollowMe.currentWeek.title) ?
                                            bulletin.comeFollowMe.currentWeek.title
                                            : '"Be Still and Know that I Am God"' %>
                                    </span>
                                </div>
                            </div>

                            <div class="program-item">
                                <div class="program-line">
                                    <span class="program-title">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.nextWeek &&
                                            bulletin.comeFollowMe.nextWeek.date) ? bulletin.comeFollowMe.nextWeek.date
                                            : 'September 21' %>
                                    </span>
                                    <span class="dots"></span>
                                    <span class="scripture-reference">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.nextWeek &&
                                            bulletin.comeFollowMe.nextWeek.scripture) ?
                                            bulletin.comeFollowMe.nextWeek.scripture : 'D&C 102-105' %>
                                    </span>
                                    <span class="scripture-title">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.nextWeek &&
                                            bulletin.comeFollowMe.nextWeek.title) ? bulletin.comeFollowMe.nextWeek.title
                                            : '"After Much Tribulation Cometh the Blessing"' %>
                                    </span>
                                </div>
                            </div>

                            <div class="program-item">
                                <div class="program-line">
                                    <span class="program-title">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.thirdWeek &&
                                            bulletin.comeFollowMe.thirdWeek.date) ? bulletin.comeFollowMe.thirdWeek.date
                                            : 'September 28' %>
                                    </span>
                                    <span class="dots"></span>
                                    <span class="scripture-reference">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.thirdWeek &&
                                            bulletin.comeFollowMe.thirdWeek.scripture) ?
                                            bulletin.comeFollowMe.thirdWeek.scripture : 'D&C 106-108' %>
                                    </span>
                                    <span class="scripture-title">
                                        <%= (bulletin.comeFollowMe && bulletin.comeFollowMe.thirdWeek &&
                                            bulletin.comeFollowMe.thirdWeek.title) ?
                                            bulletin.comeFollowMe.thirdWeek.title : '"The Order of the Son of God"' %>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Announcements Section -->
                        <div class="program-section mt-4">
                            <h4 class="section-header text-center mb-3"
                                style="border-bottom: 1px solid #333; padding-bottom: 8px;">Announcements</h4>
                            <div class="announcements-content"
                                style="white-space: pre-line; line-height: 1.6; font-size: 14px; text-align: left; padding: 0 20px;">
                                <%- bulletin.getFinalAnnouncementsText() || `September 14th: Family Heritage Follow-up
                                    Training! 7:00 in the Relief Society room. September 27th: Western Night at Rod and
                                    Lisa Petersen's Barn. Faith-based Addiction Recovery Program in person or on Zoom
                                    every Wednesday evening at 7:00 p.m. If you have questions, please call or text
                                    Sister Hawes (541) 510-4863 or email to: oregonfour@q.com. Please follow these
                                    missionary pages for daily enlightenment and a way to share the gospel of Jesus
                                    Christ with your friends: Facebook-Followers of Christ in Southern Oregon |
                                    Instagram-hopeinhim.Southernoregon Please help keep our Sister Missionaries fed!
                                    Sign up via the new digital calendar at missmeal.onrender.com to secure your spot!
                                    General Conference Tickets! If you are interested in attending the October 2025
                                    General Conference, please contact Ardel Wicks at ardelwicks@gmail.com or (541)
                                    228-4136 to get tickets. The Home Storage Center hours have changed! The update
                                    hours are on Thursdays from 12:00-5:00 and Saturdays from 10:00-1:00. Got an
                                    announcement? Text Elise Luke at (541) 373-7908 Temple Prep Class: Those planning to
                                    attend the temple for the first time, please contact Whaanga (Fonga) Kewene at (541)
                                    914-4104 or rwwkewene@gmail.com. To Dine with the Missionaries: Contact Kelly
                                    Reynolds at (541) 514-8252 to set up an appointment.` %>
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="program-section mt-4">
                            <h4 class="section-header text-center mb-3"
                                style="border-bottom: 1px solid #333; padding-bottom: 8px;">Contact Information</h4>
                            <div class="contact-table">
                                <div class="contact-header">
                                    <div class="contact-col-title">Title</div>
                                    <div class="contact-col-name">Name</div>
                                    <div class="contact-col-phone">Phone Number</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Bishop</div>
                                    <div class="contact-col-name">Ivan Walker</div>
                                    <div class="contact-col-phone">(541) 579-4436</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">1st Counselor</div>
                                    <div class="contact-col-name">Jeff Krebs</div>
                                    <div class="contact-col-phone">(541) 817-4150</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">2nd Counselor</div>
                                    <div class="contact-col-name">Jason Ryan</div>
                                    <div class="contact-col-phone">(541) 373-1891</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Executive Secretary</div>
                                    <div class="contact-col-name">Jesse Nelson</div>
                                    <div class="contact-col-phone">(509) 607-4929</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Ward Clerk</div>
                                    <div class="contact-col-name">Lowden Hansen</div>
                                    <div class="contact-col-phone">(541) 514-7879</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Financial Clerk</div>
                                    <div class="contact-col-name">Moroni Luke</div>
                                    <div class="contact-col-phone">(541) 232-0324</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Elders Quorum President</div>
                                    <div class="contact-col-name">Tony Moe</div>
                                    <div class="contact-col-phone">(541) 321-2286</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Relief Society President</div>
                                    <div class="contact-col-name">Marie Aylworth</div>
                                    <div class="contact-col-phone">(541) 954-2327</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Young Women President</div>
                                    <div class="contact-col-name">Kristan Johnston</div>
                                    <div class="contact-col-phone">(801) 319-9993</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Primary President</div>
                                    <div class="contact-col-name">Amy Poeschl</div>
                                    <div class="contact-col-phone">(541) 852-3191</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Temple & Family History</div>
                                    <div class="contact-col-name">David Freeman</div>
                                    <div class="contact-col-phone">(541) 600-7803</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Ward Building Rep</div>
                                    <div class="contact-col-name">Tim Heise</div>
                                    <div class="contact-col-phone">(385) 239-9524</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Music Chairman</div>
                                    <div class="contact-col-name">Patricia Skeen</div>
                                    <div class="contact-col-phone">(541) 689-2190</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Ward Mission Leader</div>
                                    <div class="contact-col-name">John Lancaster</div>
                                    <div class="contact-col-phone">(208) 421-3179</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Sister Missionaries</div>
                                    <div class="contact-col-name">Sisters</div>
                                    <div class="contact-col-phone">(541) 232-1081</div>
                                </div>
                                <div class="contact-row">
                                    <div class="contact-col-title">Elders</div>
                                    <div class="contact-col-name">Elders</div>
                                    <div class="contact-col-phone">(541) 285-5017</div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information Section -->
                        <div class="program-section mt-4">
                            <h4 class="section-header text-center mb-3"
                                style="border-bottom: 1px solid #333; padding-bottom: 8px;">Additional Information</h4>
                            <div style="padding: 0 20px; font-size: 14px; line-height: 1.8;">

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Appointments with the Bishop:</strong><br>
                                    To schedule appointments, please contact Jesse Nelson, Executive Secretary for the
                                    Bishop: 509.607.4929
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Ward Temple Recommends:</strong><br>
                                    Interviews are held on the 2nd Tuesday of each month from 6:00 pm to 7:00 pm in the
                                    bishop's office, on a first-come, first-serve basis. Sunday dress if possible.
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Stake Temple Recommends:</strong><br>
                                    The Stake Presidency is available for interviews on the 2nd & 3rd Tuesdays 6:00 pm
                                    to 7:00 pm at the Danebo building. Sunday Dress. If you need to meet specifically
                                    with the Stake President, schedule the appt with Ardel Wicks at 541-228-4136.
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Eugene Family Search Center:</strong><br>
                                    768 East 16th Avenue. Open Tue, Wed, & Thurs. 9a-3p and 6p-9p. 2nd and 3rd Sat
                                    10a-2p. Ancestry.com is free. More info? Call Brother Finn at 541-461-5506.
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Family Search Center:</strong><br>
                                    Rose Turtura (541)683-4752 and Bob Baker (541)689-2455.<br>
                                    <a href="http://www.eugenefamilyhistory.org/" target="_blank"
                                        style="color: #007bff;">www.eugenefamilyhistory.org/</a>
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Room Scheduling:</strong><br>
                                    To schedule specific rooms for an auxiliary activity in the Danebo building or
                                    pavilion, contact Margaret Hansen at 541.556.3296 or <a
                                        href="mailto:gregnmeg@gmail.com" style="color: #007bff;">gregnmeg@gmail.com</a>.
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">LDS Employment:</strong><br>
                                    Located at the LDS Institute Building 768 E.16th, 541-747-1524
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Healing Through Christ:</strong><br>
                                    The LDS Addiction Recovery Support Group every Wednesday, 7:00 pm at the River Road
                                    Building, Room 24 (3132 River Rd., Eugene). These are confidential meetings. Anyone
                                    18 or older is invited.
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Portland Temple Visitors Center:</strong><br>
                                    Open 365 days a year from 9 am-9 pm. All invited.
                                </div>

                                <div style="margin-bottom: 15px;">
                                    <strong style="color: #6f42c1;">Portland Temple Baptistry:</strong><br>
                                    The "open period" for family file ordinances are: Sat. 9 am-10:30 am and Tues-Fri.
                                    4pm-5pm. Schedule by calling the temple office at 503.639.7066.
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
            <script>
                // Navigation Functions
                function toggleAccordion(accordionId) {
                    const content = document.getElementById(accordionId);
                    if (!content) return;

                    const button = content.previousElementSibling;
                    const icon = button ? button.querySelector('.accordion-icon') : null;

                    content.classList.toggle('show');
                    if (icon) {
                        icon.classList.toggle('rotated');
                    }
                }
            </script>

            <% if (user && user.permissions && user.permissions.accessBulletinManagement) { %>
                <script>
                    // Quick edit functionality
                    document.querySelectorAll('.editable-field').forEach(field => {
                        field.addEventListener('click', function () {
                            const fieldName = this.dataset.field;
                            const currentValue = this.textContent.trim();

                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = currentValue;
                            input.className = 'form-control form-control-sm';
                            input.style.fontSize = window.getComputedStyle(this).fontSize;

                            const parent = this.parentNode;
                            parent.replaceChild(input, this);
                            input.focus();
                            input.select();

                            const saveChanges = () => {
                                const newValue = input.value.trim();

                                fetch(`/bulletin/<%= bulletin._id %>/quick-update`, {
                                    method: 'PATCH',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        field: fieldName,
                                        value: newValue
                                    })
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            field.textContent = newValue;
                                            parent.replaceChild(field, input);
                                        } else {
                                            alert('Error updating field: ' + data.message);
                                            parent.replaceChild(field, input);
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        alert('Error updating field');
                                        parent.replaceChild(field, input);
                                    });
                            };

                            input.addEventListener('blur', saveChanges);
                            input.addEventListener('keypress', function (e) {
                                if (e.key === 'Enter') {
                                    saveChanges();
                                } else if (e.key === 'Escape') {
                                    parent.replaceChild(field, input);
                                }
                            });
                        });
                    });
                </script>
                <% } %>

                    <!-- Floating Navigation -->
                    <div class="floating-nav">
                        <% if (user && ((user.permissions && user.permissions.accessBulletinManagement) ||
                            user.role==='admin' || user.role==='manager' )) { %>
                            <a href="/bulletin/<%= bulletin._id %>/edit" class="fab fab-primary" title="Edit Bulletin">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="/bulletin/admin" class="fab fab-primary" title="Admin Dashboard">
                                <i class="fas fa-cog"></i>
                            </a>
                            <% } %>
                                <button onclick="window.print()" class="fab fab-secondary" title="Print Bulletin">
                                    <i class="fas fa-print"></i>
                                </button>
                                <a href="/" class="fab fab-secondary" title="Main Dashboard">
                                    <i class="fas fa-home"></i>
                                </a>
                    </div>

    <!-- Person Info Modal -->
    <div id="personModal" class="person-modal">
        <div class="person-modal-content">
            <div class="person-modal-header">
                <h3 id="personModalName"></h3>
                <span class="person-modal-close" onclick="closePersonModal()">&times;</span>
            </div>
            <div class="person-modal-body" id="personModalNotes"></div>
        </div>
    </div>

    <script>
        // Person info modal functions
        function showPersonInfo(element) {
            const name = element.dataset.personName;
            const notes = element.dataset.personNotes;
            
            document.getElementById('personModalName').textContent = name;
            document.getElementById('personModalNotes').textContent = notes;
            document.getElementById('personModal').style.display = 'block';
        }

        function closePersonModal() {
            document.getElementById('personModal').style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('personModal');
            if (event.target == modal) {
                closePersonModal();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closePersonModal();
            }
        });

        // User Dropdown Toggle
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        window.addEventListener('click', function(e) {
            if (!e.target.matches('.user-avatar')) {
                const dropdown = document.getElementById('userDropdown');
                if (dropdown && dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        });
    </script>
</body>

</html>